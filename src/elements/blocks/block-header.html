<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/app-route/app-location.html">
<link rel="import" href="../blocks/block-menu.html">
<link rel="import" href="../blocks/block-menu-mobile.html">
<link rel="import" href="../util/app-viewport.html">
<link rel="import" href="../../styles/shared.html">

<dom-module id="block-header">
  <template>
    <style include="shared">
      :host {
        display: block;
        position: relative;
      }
      .header {
        background: #cc0002;
      }
      .logo {
        padding: 1rem 0;
      }
      .logo a {
        display: block;
        width: 460px;
        height: 68px;
        background: url(../../../images/poder-edomex.svg) no-repeat 16px top;
      }

      .search-box {
        background: #FFF;
        height: 26px;
        width: 180px;
        display: inline-block;
        float: right;
        margin-top: 16px
      }
      .search-box input {
        font-size: .8rem;
        background: transparent;
        border: 0;
        padding: 0 0 0 .5rem;
        outline: 0
      }
      .search-icon {
        height: 20px;
        width: 20px;
        background: url(../../../images/icons/search.svg) no-repeat top left;
        background-size: 16px;
        position: absolute;
        right: 16px;
        top: 21px;
        cursor: pointer;
      }

      .date {
        font-size: .8rem;
        text-align: right;
        color: #FFF;
        margin-top: 30px;
      }

      input:-webkit-autofill {
        -webkit-box-shadow: 0 0 0 1000px #FFF inset;
      }

      .spacer {
        height: 50px;
      }

      .headerMobile {
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
        display: flex;
        background: #cc0002;
        height: 50px;
        opacity: 1;
      }

      .headerMobile .menu {
        width: 70px;
      }

      .headerMobile .logo {
        flex: 1;
        padding: 0;
      }

      .headerMobile .logo a {
        background: url(../../../images/poder-edomex-mobile.svg) no-repeat 16px top;
        width: 100%;
        height: 50px;
        background-size: 100% 20px;
        background-position: left 15px;
      }

      .headerMobile .search {
        width: 70px;
        text-align: right;
      }

      .headerMobile .menu,
      .headerMobile .search {
        @apply --joornalo-icon;
        cursor: pointer;
        color: #FFF;
        font-size: 1.4rem;
        padding-top: .8rem;
      }
      
      .headerMobile .menu:before {
        content: "\e9bd";
        padding-left: .8rem;
      }
      .headerMobile .search:before {
        content: "\e986";
        padding-right: .8rem;
      }



      

    </style>

    <app-location id="location" use-hash-as-path></app-location>

    <app-viewport xl="{{xl}}" lg="{{lg}}" md="{{md}}" sm="{{sm}}"></app-viewport>

    <div class="header" hidden$="[[mobile]]">
      <div class="container-fluid">

        <div class="row">

          <div class="col-lg-8 col-md-6">
            <div class="logo">
              <a href="#/front/home"></a>
            </div>
          </div>

          <div class="col-lg-4 col-md-4">
            <div class="row">
              <div class="col">

                <div class="search-box">
                  <input id="search" value="{{search::input}}" placeholder="Buscar" type="text" on-keydown="_keydown">
                  <div on-tap="_submit" class="search-icon"></div>
                </div>

              </div>
            </div>

            <div class="row">
              <div class="col">

                <div class="date">[[date]]</div>

              </div>
            </div>
          </div>

        </div>

        <block-menu menu="[[menu]]"></block-menu>

      </div>
    </div>

    <div hidden$="[[!mobile]]">

      <div class="spacer"></div>

      <div class="headerMobile">

        <div class="menu" on-tap="_mobileMenu"></div>

        <div class="logo">
          <a href="#/front/home"></a>
        </div>

        <a class="search" href="#/search"></a>

        <block-menu-mobile show="{{showMenu}}" menu="[[menu]]"></block-menu-mobile>

      </div>

    </div>

  </template>

  <script>
  
    class BlockHeader extends Polymer.GestureEventListeners(Polymer.Element) {
      static get is() { return 'block-header'; }
      static get properties() {
        return {

          menu: {
            type: Object
          },

          search: {
            type: String
          },

          date: {
            type: String,
            value: null
          },

          mobile: {
            type: Boolean,
            value: false
          },

          gMd: {
            type: Boolean,
            value: false
          },

          showMenu: {
            type: Boolean,
            value: false
          }

        };
      }

      static get observers() {
        return [
          '_viewports(xl, lg, md, sm)'
        ]
      }

      ready() {
        super.ready();

        let days = ['Domingo','Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
            months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
            date = new Date();

        this.date = days[date.getDay()] + ', ' + months[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear();
      }

      _keydown(e) {

        if (e.key == 'Enter') {
          console.log(this.search);

          if(this.search.length>0) {
            let search = this.search.replace(/\s+/g,' ').trim().replace(/ /g, "+");
            this.$.location.set('path', '/search/'+search);
            this.search = '';
          }
        }

      }

      _submit() {
        let search = '';
        if(this.search && this.search.length>0) {
          search = this.search.replace(/\s+/g,' ').trim().replace(/ /g, "+");
        }
        this.$.location.set('path', '/search/'+search);
        this.search = '';
      }

      _viewports(xl, lg, md, sm) {
        this.gMd = (xl || lg);
        this.mobile = !this.gMd;
      }

      _mobileMenu() {

        this.showMenu = !this.showMenu;
        console.log("show:",this.showMenu);

      }


    }

    window.customElements.define(BlockHeader.is, BlockHeader);
  </script>
</dom-module>
